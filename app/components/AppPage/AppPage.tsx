import { AppBar, BottomNavigation, BottomNavigationAction, Box, Container, Icon, Paper, Stack, SvgIcon, Toolbar, Typography } from "@mui/material";
import { usePathname, useRouter } from "next/navigation";
import { ReactNode, useCallback } from "react";
import { AppIcon } from "@/app/components/AppIcon";
import styles from "./AppPage.module.css";

const PantryIcon = () => {
    return (
        <svg
            width="31"
            height="31"
            viewBox="0 0 31 31"
            stroke="currentColor"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <g clipPath="url(#clip0_104_308)">
                <path d="M17.123 10.4583V7.08063H18.4147V10.4583H17.123ZM17.123 20.9402V15.3279H18.4147V20.9415L17.123 20.9402ZM15.086 27.25C14.5091 27.25 14.017 27.0468 13.6097 26.6403C13.2032 26.2339 13 25.7418 13 25.164V6.08604C13 5.5091 13.2032 5.01697 13.6097 4.60967C14.0161 4.20322 14.5082 4 15.086 4H28.9973C29.5742 4 30.0664 4.20322 30.4737 4.60967C30.8801 5.01611 31.0833 5.50824 31.0833 6.08604V25.164C31.0833 25.7409 30.8801 26.233 30.4737 26.6403C30.0672 27.0468 29.5751 27.25 28.9973 27.25H15.086ZM15.086 25.9583H28.9973C29.2289 25.9583 29.4192 25.8838 29.5682 25.7349C29.7172 25.5859 29.7917 25.3956 29.7917 25.164V13.539H14.2917V25.164C14.2917 25.3956 14.3662 25.5859 14.5151 25.7349C14.6641 25.8838 14.8544 25.9583 15.086 25.9583ZM14.2917 12.2473H29.7917V6.08604C29.7917 5.8544 29.7172 5.6641 29.5682 5.51512C29.4192 5.36615 29.2289 5.29167 28.9973 5.29167H15.086C14.8544 5.29167 14.6641 5.36615 14.5151 5.51512C14.3662 5.6641 14.2917 5.8544 14.2917 6.08604V12.2473Z" fill="black"/>
            </g>
            <defs>
                <clipPath id="clip0_104_308">
                    <rect width="31" height="31" fill="white"/>
                </clipPath>
            </defs>
        </svg>
    );
};

const RecipesIcon = () => {
    return (
        <svg
            width="25"
            height="25"
            viewBox="0 0 25 25"
            stroke="currentColor"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M4.90625 13.8896H5.6875C5.68742 13.7376 5.64304 13.589 5.55978 13.4619C5.47652 13.3348 5.35801 13.2347 5.21875 13.174L4.90625 13.8896ZM19.4896 13.8896L19.1771 13.174C19.0378 13.2347 18.9193 13.3348 18.8361 13.4619C18.7528 13.589 18.7084 13.7376 18.7083 13.8896H19.4896ZM16.1042 5.98958C16.1042 6.19678 16.1865 6.3955 16.333 6.54201C16.4795 6.68852 16.6782 6.77083 16.8854 6.77083C17.0926 6.77083 17.2913 6.68852 17.4378 6.54201C17.5844 6.3955 17.6667 6.19678 17.6667 5.98958H16.1042ZM6.72917 5.98958C6.72917 6.19678 6.81148 6.3955 6.95799 6.54201C7.1045 6.68852 7.30322 6.77083 7.51042 6.77083C7.71762 6.77083 7.91633 6.68852 8.06284 6.54201C8.20936 6.3955 8.29167 6.19678 8.29167 5.98958H6.72917ZM6.98958 3.125C5.40105 3.125 3.87757 3.75604 2.75431 4.87931C1.63104 6.00257 1 7.52605 1 9.11458H2.5625C2.5625 7.94045 3.02892 6.8144 3.85916 5.98416C4.6894 5.15392 5.81545 4.6875 6.98958 4.6875V3.125ZM17.4063 4.6875C18.5804 4.6875 19.7064 5.15392 20.5367 5.98416C21.3669 6.8144 21.8333 7.94045 21.8333 9.11458H23.3958C23.3958 7.52605 22.7648 6.00257 21.6415 4.87931C20.5183 3.75604 18.9948 3.125 17.4063 3.125V4.6875ZM15.3229 20.8333H9.07292V22.3958H15.3229V20.8333ZM9.07292 20.8333C8.06875 20.8333 7.39375 20.8313 6.89063 20.7635C6.41042 20.699 6.20417 20.5875 6.06875 20.451L4.96458 21.5573C5.43854 22.0313 6.02917 22.224 6.68333 22.3125C7.31458 22.3979 8.1125 22.3958 9.07292 22.3958V20.8333ZM4.125 17.4479C4.125 18.4083 4.12292 19.2063 4.20833 19.8375C4.29583 20.4917 4.48958 21.0823 4.96354 21.5563L6.06875 20.4521C5.93333 20.3167 5.82188 20.1104 5.75625 19.6292C5.68958 19.1271 5.6875 18.4521 5.6875 17.4479H4.125ZM18.7083 17.4479C18.7083 18.4521 18.7063 19.1271 18.6385 19.6302C18.574 20.1104 18.4625 20.3167 18.326 20.4521L19.4323 21.5563C19.9063 21.0823 20.099 20.4917 20.1875 19.8375C20.2729 19.2063 20.2708 18.4083 20.2708 17.4479H18.7083ZM15.3229 22.3958C16.2833 22.3958 17.0813 22.3979 17.7125 22.3125C18.3667 22.225 18.9583 22.0313 19.4323 21.5563L18.3271 20.4521C18.1917 20.5875 17.9854 20.699 17.5042 20.7646C17.0021 20.8313 16.3271 20.8333 15.3229 20.8333V22.3958ZM6.98958 4.6875C7.2125 4.6875 7.43021 4.70417 7.64375 4.73542L7.87188 3.18958C7.57975 3.14649 7.28487 3.12491 6.98958 3.125V4.6875ZM12.1979 0C11.055 1.18153e-06 9.94073 0.357965 9.01164 1.02363C8.08255 1.6893 7.38527 2.62923 7.01771 3.71146L8.49688 4.21354C8.75955 3.44043 9.25776 2.76899 9.92155 2.29352C10.5854 1.81804 11.3814 1.5624 12.1979 1.5625V0ZM7.01771 3.71146C6.82607 4.2775 6.72859 4.87115 6.72917 5.46875H8.29167C8.29167 5.02813 8.36458 4.60625 8.49792 4.21354L7.01771 3.71146ZM17.4063 3.125C17.1073 3.125 16.8125 3.14688 16.524 3.18958L16.7531 4.73542C16.9694 4.70349 17.1877 4.68748 17.4063 4.6875V3.125ZM12.1979 1.5625C13.0143 1.56262 13.8101 1.81836 14.4737 2.29382C15.1373 2.76928 15.6353 3.44059 15.8979 4.21354L17.3771 3.71146C17.0096 2.6294 16.3125 1.68958 15.3836 1.02393C14.4547 0.358284 13.3407 0.000218775 12.1979 0V1.5625ZM15.8979 4.21354C16.0313 4.60625 16.1042 5.02813 16.1042 5.46875H17.6667C17.6667 4.85521 17.5646 4.26458 17.3771 3.71146L15.8979 4.21354ZM5.6875 17.4479V13.8896H4.125V17.4479H5.6875ZM5.21875 13.174C4.42904 12.8292 3.75709 12.2614 3.28527 11.5404C2.81345 10.8193 2.56227 9.97628 2.5625 9.11458H1C0.999922 10.2802 1.33988 11.4205 1.97821 12.3957C2.61654 13.371 3.52552 14.1389 4.59375 14.6052L5.21875 13.174ZM18.7083 13.8896V17.4479H20.2708V13.8896H18.7083ZM21.8333 9.11458C21.8336 9.97628 21.5824 10.8193 21.1106 11.5404C20.6387 12.2614 19.9668 12.8292 19.1771 13.174L19.8021 14.6052C20.8703 14.1389 21.7793 13.371 22.4176 12.3957C23.056 11.4205 23.3959 10.2802 23.3958 9.11458H21.8333ZM16.1042 5.46875V5.98958H17.6667V5.46875H16.1042ZM6.72917 5.46875V5.98958H8.29167V5.46875H6.72917Z" fill="black"/>
            <path
                d="M4.90625 17.4479H19.4896"
                stroke="black"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
            />
        </svg>
    );
};

const GroceriesIcon = () => {
    return (
        <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke="currentColor"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M18.9474 18.9474C19.6174 18.9474 20.26 19.2135 20.7337 19.6873C21.2075 20.1611 21.4737 20.8037 21.4737 21.4737C21.4737 22.1437 21.2075 22.7863 20.7337 23.2601C20.26 23.7338 19.6174 24 18.9474 24C18.2773 24 17.6348 23.7338 17.161 23.2601C16.6872 22.7863 16.4211 22.1437 16.4211 21.4737C16.4211 20.8037 16.6872 20.1611 17.161 19.6873C17.6348 19.2135 18.2773 18.9474 18.9474 18.9474ZM18.9474 20.2105C18.6124 20.2105 18.2911 20.3436 18.0542 20.5805C17.8173 20.8174 17.6842 21.1387 17.6842 21.4737C17.6842 21.8087 17.8173 22.13 18.0542 22.3669C18.2911 22.6038 18.6124 22.7368 18.9474 22.7368C19.2824 22.7368 19.6037 22.6038 19.8406 22.3669C20.0774 22.13 20.2105 21.8087 20.2105 21.4737C20.2105 21.1387 20.0774 20.8174 19.8406 20.5805C19.6037 20.3436 19.2824 20.2105 18.9474 20.2105ZM7.57895 18.9474C8.24897 18.9474 8.89155 19.2135 9.36532 19.6873C9.8391 20.1611 10.1053 20.8037 10.1053 21.4737C10.1053 22.1437 9.8391 22.7863 9.36532 23.2601C8.89155 23.7338 8.24897 24 7.57895 24C6.90893 24 6.26635 23.7338 5.79257 23.2601C5.3188 22.7863 5.05263 22.1437 5.05263 21.4737C5.05263 20.8037 5.3188 20.1611 5.79257 19.6873C6.26635 19.2135 6.90893 18.9474 7.57895 18.9474ZM7.57895 20.2105C7.24394 20.2105 6.92265 20.3436 6.68576 20.5805C6.44887 20.8174 6.31579 21.1387 6.31579 21.4737C6.31579 21.8087 6.44887 22.13 6.68576 22.3669C6.92265 22.6038 7.24394 22.7368 7.57895 22.7368C7.91396 22.7368 8.23525 22.6038 8.47213 22.3669C8.70902 22.13 8.8421 21.8087 8.8421 21.4737C8.8421 21.1387 8.70902 20.8174 8.47213 20.5805C8.23525 20.3436 7.91396 20.2105 7.57895 20.2105ZM21.4737 3.78947H4.13053L7.35158 11.3684H17.6842C18.1011 11.3684 18.4674 11.1663 18.6947 10.8632L22.4842 5.81053C22.6484 5.59579 22.7368 5.33053 22.7368 5.05263C22.7368 4.71762 22.6038 4.39633 22.3669 4.15944C22.13 3.92256 21.8087 3.78947 21.4737 3.78947ZM17.6842 12.6316H7.41474L6.4421 14.6021L6.31579 15.1579C6.31579 15.4929 6.44887 15.8142 6.68576 16.0511C6.92265 16.288 7.24394 16.4211 7.57895 16.4211H21.4737V17.6842H7.57895C6.90893 17.6842 6.26635 17.418 5.79257 16.9443C5.3188 16.4705 5.05263 15.8279 5.05263 15.1579C5.05226 14.7293 5.16093 14.3077 5.36842 13.9326L6.27789 12.0758L1.69263 1.26316H0V0H2.52632L3.6 2.52632H21.4737C22.1437 2.52632 22.7863 2.79248 23.2601 3.26626C23.7338 3.74003 24 4.38261 24 5.05263C24 5.68421 23.7853 6.21474 23.4316 6.64421L19.7558 11.5579C19.3011 12.2021 18.5432 12.6316 17.6842 12.6316Z" fill="black"/>
        </svg>
    );
};

const ProfileIcon = () => {
    return (
        <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke="currentColor"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M12.1596 11.62C12.1296 11.62 12.1096 11.62 12.0796 11.62C12.0296 11.61 11.9596 11.61 11.8996 11.62C8.9996 11.53 6.8096 9.25 6.8096 6.44C6.8096 3.58 9.1396 1.25 11.9996 1.25C14.8596 1.25 17.1896 3.58 17.1896 6.44C17.1796 9.25 14.9796 11.53 12.1896 11.62C12.1796 11.62 12.1696 11.62 12.1596 11.62ZM11.9996 2.75C9.9696 2.75 8.3096 4.41 8.3096 6.44C8.3096 8.44 9.8696 10.05 11.8596 10.12C11.9096 10.11 12.0496 10.11 12.1796 10.12C14.1396 10.03 15.6796 8.42 15.6896 6.44C15.6896 4.41 14.0296 2.75 11.9996 2.75Z" fill="#0C0C0C"/>
            <path d="M12.1696 22.55C10.2096 22.55 8.23961 22.05 6.74961 21.05C5.35961 20.13 4.59961 18.87 4.59961 17.5C4.59961 16.13 5.35961 14.86 6.74961 13.93C9.74961 11.94 14.6096 11.94 17.5896 13.93C18.9696 14.85 19.7396 16.11 19.7396 17.48C19.7396 18.85 18.9796 20.12 17.5896 21.05C16.0896 22.05 14.1296 22.55 12.1696 22.55ZM7.57961 15.19C6.61961 15.83 6.09961 16.65 6.09961 17.51C6.09961 18.36 6.62961 19.18 7.57961 19.81C10.0696 21.48 14.2696 21.48 16.7596 19.81C17.7196 19.17 18.2396 18.35 18.2396 17.49C18.2396 16.64 17.7096 15.82 16.7596 15.19C14.2696 13.53 10.0696 13.53 7.57961 15.19Z" fill="#0C0C0C"/>
        </svg>
    );
};

export enum MenuItem {
    PANTRY = "pantry",
    RECIPES = "recipes",
    GROCERY_LIST = "grocery-list",
    PROFILE = "profile",
};

const MENU_ITEM_TO_PATH: {[key in MenuItem]: string} = {
    [MenuItem.PANTRY]: "/pantry",
    [MenuItem.RECIPES]: "/recipes",
    [MenuItem.GROCERY_LIST]: "/grocery",
    [MenuItem.PROFILE]: "/profile",
};

const PATH_TO_MENU_ITEM: {[key: string]: MenuItem} = Object.fromEntries<MenuItem>(
    Object.entries(MENU_ITEM_TO_PATH).map(([key, value]) => [value, key as MenuItem])
);

export const AppPage = ({
    title,
    subtitle,
    children,
}: {
    title: string;
    subtitle?: string;
    children: ReactNode;
}) => {
    const pathname = usePathname();
    const selectedMenuItem = PATH_TO_MENU_ITEM[pathname];

    const router = useRouter();
    const handleSelectedMenuItemChange = useCallback(
        (event: unknown, newValue: MenuItem) => {
            router.push(MENU_ITEM_TO_PATH[newValue]);
        },
    [router]);

    return (
        <Box
            height="100%"
            width="100%"
            sx={{paddingBottom: 7, flexGrow: 1}}
        >
            <AppBar position="static">
                <Toolbar
                    sx={{paddingLeft: 0}}
                >
                    <AppIcon
                        width={24}
                        height={24}
                    />
                    <Stack>
                        <Typography
                            variant="h4"
                            component="div"
                            sx={{flexGrow: 1}}
                        >
                            {title}
                        </Typography>
                        {
                            subtitle ? (
                                <Typography variant="subtitle1">
                                    {subtitle}
                                </Typography>
                            ) : null
                        }
                    </Stack>
                </Toolbar>
            </AppBar>
            <Container>
                {children}
            </Container>
            <Paper
                sx={{position: "fixed", bottom: 0, left: 0, right: 0}}
                elevation={3}
            >
                <BottomNavigation
                    value={selectedMenuItem}
                    onChange={handleSelectedMenuItemChange}
                >
                    <BottomNavigationAction
                        label="Pantry"
                        value={MenuItem.PANTRY}
                        icon={<PantryIcon />}
                    />
                    <BottomNavigationAction
                        label="Recipes"
                        value={MenuItem.RECIPES}
                        icon={<RecipesIcon />}
                    />
                    <BottomNavigationAction
                        label="Grocery List"
                        value={MenuItem.GROCERY_LIST}
                        icon={<GroceriesIcon />}
                    />
                    <BottomNavigationAction
                        label="Profile"
                        value={MenuItem.PROFILE}
                        icon={<ProfileIcon />}
                    />
                </BottomNavigation>
            </Paper>
        </Box>
    );
};
